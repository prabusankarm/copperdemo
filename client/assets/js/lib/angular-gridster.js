!function(e,t){"use strict";"function"==typeof define&&define.amd?define(["angular"],t):"object"==typeof exports?module.exports=t(require("angular")):t(e.angular)}(this,function(R){"use strict";return R.module("gridster",[]).constant("gridsterConfig",{columns:4,pushing:!0,floating:!0,swapping:!1,width:"auto",colWidth:"auto",rowHeight:"*1",margins:[10,10],outerMargin:!0,sparse:!1,isMobile:!1,mobileBreakPoint:600,mobileModeEnabled:!0,minColumns:1,minRows:1,maxRows:50,defaultSizeX:1,defaultSizeY:1,minSizeX:1,maxSizeX:4,minSizeY:1,maxSizeY:4,saveGridItemCalculatedHeightInMobile:!1,resizable:{enabled:!0,handles:["s","e","n","w","se","ne","sw","nw"]},draggable:{enabled:!0,scrollSensitivity:20,scrollSpeed:15}}).controller("GridsterCtrl",["gridsterConfig","$timeout",function(e,t){var i=this;R.extend(this,e),this.resizable=R.extend({},e.resizable||{}),this.draggable=R.extend({},e.draggable||{});var r=!1;this.layoutChanged=function(){r||(r=!0,t(function(){r=!1,i.loaded&&i.floatItemsUp(),i.updateHeight(i.movingItem?i.movingItem.sizeY:0)},30))},this.grid=[],this.allItems=[],this.destroy=function(){this.grid&&(this.grid=[]),this.$element=null,this.allItems&&(this.allItems.length=0,this.allItems=null)},this.setOptions=function(e){if(e)if((e=R.extend({},e)).draggable&&(R.extend(this.draggable,e.draggable),delete e.draggable),e.resizable&&(R.extend(this.resizable,e.resizable),delete e.resizable),R.extend(this,e),this.margins&&2===this.margins.length)for(var t=0,i=this.margins.length;t<i;++t)this.margins[t]=parseInt(this.margins[t],10),isNaN(this.margins[t])&&(this.margins[t]=0);else this.margins=[0,0]},this.canItemOccupy=function(e,t,i){return-1<t&&-1<i&&e.sizeX+i<=this.columns&&e.sizeY+t<=this.maxRows},this.autoSetItemPosition=function(e){for(var t=0;t<this.maxRows;++t)for(var i=0;i<this.columns;++i){if(0===this.getItems(t,i,e.sizeX,e.sizeY,e).length&&this.canItemOccupy(e,t,i))return void this.putItem(e,t,i)}throw new Error("Unable to place item!")},this.getItems=function(e,t,i,r,s){var n,o=[];if(i&&r||(i=r=1),!s||s instanceof Array||(s=[s]),!1===this.sparse)for(var a=0;a<r;++a)for(var l=0;l<i;++l)!(n=this.getItem(e+a,t+l,s))||s&&-1!==s.indexOf(n)||-1!==o.indexOf(n)||o.push(n);else for(var d=e+r-1,h=t+i-1,c=0;c<this.allItems.length;++c)!(n=this.allItems[c])||s&&-1!==s.indexOf(n)||-1!==o.indexOf(n)||!this.intersect(n,t,h,e,d)||o.push(n);return o},this.getBoundingBox=function(e){if(0===e.length)return null;if(1===e.length)return{row:e[0].row,col:e[0].col,sizeY:e[0].sizeY,sizeX:e[0].sizeX};for(var t=0,i=0,r=9999,s=9999,n=0,o=e.length;n<o;++n){var a=e[n];r=Math.min(a.row,r),s=Math.min(a.col,s),t=Math.max(a.row+a.sizeY,t),i=Math.max(a.col+a.sizeX,i)}return{row:r,col:s,sizeY:t-r,sizeX:i-s}},this.intersect=function(e,t,i,r,s){return t<=e.col+e.sizeX-1&&i>=e.col&&r<=e.row+e.sizeY-1&&s>=e.row},this.removeItem=function(e){for(var t,i=0,r=this.grid.length;i<r;++i){var s=this.grid[i];if(s&&-1!==(t=s.indexOf(e))){s[t]=null;break}}this.sparse&&-1!==(t=this.allItems.indexOf(e))&&this.allItems.splice(t,1),this.layoutChanged()},this.getItem=function(e,t,i){!i||i instanceof Array||(i=[i]);for(var r=1;-1<e;){for(var s=1,n=t;-1<n;){var o=this.grid[e];if(o){var a=o[n];if(a&&(!i||-1===i.indexOf(a))&&a.sizeX>=s&&a.sizeY>=r)return a}++s,--n}--e,++r}return null},this.putItems=function(e){for(var t=0,i=e.length;t<i;++t)this.putItem(e[t])},this.putItem=function(e,t,i,r){if(null!=t||(t=e.row,i=e.col,null!=t)){if(this.canItemOccupy(e,t,i)||(i=Math.min(this.columns-e.sizeX,Math.max(0,i)),t=Math.min(this.maxRows-e.sizeY,Math.max(0,t))),null!==e.oldRow&&void 0!==e.oldRow){var s=e.oldRow===t&&e.oldColumn===i,n=this.grid[t]&&this.grid[t][i]===e;if(s&&n)return e.row=t,void(e.col=i);var o=this.grid[e.oldRow];o&&o[e.oldColumn]===e&&delete o[e.oldColumn]}e.oldRow=e.row=t,e.oldColumn=e.col=i,this.moveOverlappingItems(e,r),this.grid[t]||(this.grid[t]=[]),this.grid[t][i]=e,this.sparse&&-1===this.allItems.indexOf(e)&&this.allItems.push(e),this.movingItem===e&&this.floatItemUp(e),this.layoutChanged()}else this.autoSetItemPosition(e)},this.swapItems=function(e,t){this.grid[e.row][e.col]=t;var i=(this.grid[t.row][t.col]=e).row,r=e.col;e.row=t.row,e.col=t.col,t.row=i,t.col=r},this.moveOverlappingItems=function(e,t){t?-1===t.indexOf(e)&&(t=t.slice(0)).push(e):t=[e];var i=this.getItems(e.row,e.col,e.sizeX,e.sizeY,t);this.moveItemsDown(i,e.row+e.sizeY,t)},this.moveItemsDown=function(e,t,i){if(e&&0!==e.length){e.sort(function(e,t){return e.row-t.row}),i=i?i.slice(0):[];var r,s,n,o={};for(s=0,n=e.length;s<n;++s){var a=o[(r=e[s]).col];(void 0===a||r.row<a)&&(o[r.col]=r.row)}for(s=0,n=e.length;s<n;++s){var l=t-o[(r=e[s]).col];this.moveItemDown(r,r.row+l,i),i.push(r)}}},this.moveItemDown=function(e,t,i){if(!(e.row>=t)){for(;e.row<t;)++e.row,this.moveOverlappingItems(e,i);this.putItem(e,e.row,e.col,i)}},this.floatItemsUp=function(){if(!1!==this.floating)for(var e=0,t=this.grid.length;e<t;++e){var i=this.grid[e];if(i)for(var r=0,s=i.length;r<s;++r){var n=i[r];n&&this.floatItemUp(n)}}},this.floatItemUp=function(e){if(!1!==this.floating){for(var t=e.col,i=e.sizeY,r=e.sizeX,s=null,n=null,o=e.row-1;-1<o;){if(0!==this.getItems(o,t,r,i,e).length)break;s=o,n=t,--o}null!==s&&this.putItem(e,s,n)}},this.updateHeight=function(e){var t=this.minRows;e=e||0;for(var i=this.grid.length;0<=i;--i){var r=this.grid[i];if(r)for(var s=0,n=r.length;s<n;++s)r[s]&&(t=Math.max(t,i+e+r[s].sizeY))}this.gridHeight=0<this.maxRows-t?Math.min(this.maxRows,t):Math.max(this.maxRows,t)},this.pixelsToRows=function(e,t){return this.outerMargin||(e+=this.margins[0]/2),!0===t?Math.ceil(e/this.curRowHeight):!1===t?Math.floor(e/this.curRowHeight):Math.round(e/this.curRowHeight)},this.pixelsToColumns=function(e,t){return this.outerMargin||(e+=this.margins[1]/2),!0===t?Math.ceil(e/this.curColWidth):!1===t?Math.floor(e/this.curColWidth):Math.round(e/this.curColWidth)}}]).directive("gridsterPreview",function(){return{replace:!0,scope:!0,require:"^gridster",template:'<div ng-style="previewStyle()" class="gridster-item gridster-preview-holder"></div>',link:function(e,t,i,r){e.previewStyle=function(){return r.movingItem?{display:"block",height:r.movingItem.sizeY*r.curRowHeight-r.margins[0]+"px",width:r.movingItem.sizeX*r.curColWidth-r.margins[1]+"px",top:r.movingItem.row*r.curRowHeight+(r.outerMargin?r.margins[0]:0)+"px",left:r.movingItem.col*r.curColWidth+(r.outerMargin?r.margins[1]:0)+"px"}:{display:"none"}}}}}).directive("gridster",["$timeout","$window","$rootScope","gridsterDebounce",function(g,u,m,f){return{scope:!0,restrict:"EAC",controller:"GridsterCtrl",controllerAs:"gridster",compile:function(e){return e.prepend('<div ng-if="gridster.movingItem" gridster-preview></div>'),function(e,a,t,l){l.loaded=!1,l.$element=a,e.gridster=l,a.addClass("gridster");var d=function(e){return"hidden"!==e.style.visibility&&"none"!==e.style.display};function h(){a.css("height",l.gridHeight*l.curRowHeight+(l.outerMargin?l.margins[0]:-l.margins[0])+"px")}function i(e){if(l.setOptions(e),d(a[0])){"auto"===l.width?l.curWidth=a[0].offsetWidth||parseInt(a.css("width"),10):l.curWidth=l.width,"auto"===l.colWidth?l.curColWidth=(l.curWidth+(l.outerMargin?-l.margins[1]:l.margins[1]))/l.columns:l.curColWidth=l.colWidth,l.curRowHeight=l.rowHeight,"string"==typeof l.rowHeight&&("match"===l.rowHeight?l.curRowHeight=Math.round(l.curColWidth):-1!==l.rowHeight.indexOf("*")?l.curRowHeight=Math.round(l.curColWidth*l.rowHeight.replace("*","").replace(" ","")):-1!==l.rowHeight.indexOf("/")&&(l.curRowHeight=Math.round(l.curColWidth/l.rowHeight.replace("/","").replace(" ","")))),l.isMobile=l.mobileModeEnabled&&l.curWidth<=l.mobileBreakPoint;for(var t=0,i=l.grid.length;t<i;++t){var r=l.grid[t];if(r)for(var s=0,n=r.length;s<n;++s)if(r[s]){var o=r[s];o.setElementPosition(),o.setElementSizeY(),o.setElementSizeX()}}h()}}e.$watch(function(){return l.gridHeight},h),e.$watch(function(){return l.movingItem},function(){l.updateHeight(l.movingItem?l.movingItem.sizeY:0)});var r=t.gridster;r?e.$parent.$watch(r,function(e){i(e)},!0):i({}),e.$watch(function(){return l.loaded},function(){l.loaded?(a.addClass("gridster-loaded"),m.$broadcast("gridster-loaded",l)):a.removeClass("gridster-loaded")}),e.$watch(function(){return l.isMobile},function(){l.isMobile?a.addClass("gridster-mobile").removeClass("gridster-desktop"):a.removeClass("gridster-mobile").addClass("gridster-desktop"),m.$broadcast("gridster-mobile-changed",l)}),e.$watch(function(){return l.draggable},function(){m.$broadcast("gridster-draggable-changed",l)},!0),e.$watch(function(){return l.resizable},function(){m.$broadcast("gridster-resizable-changed",l)},!0);var s=a[0].offsetWidth||parseInt(a.css("width"),10),n=function(){var e=a[0].offsetWidth||parseInt(a.css("width"),10);e&&e!==s&&!l.movingItem&&(s=e,l.loaded&&a.removeClass("gridster-loaded"),i(),l.loaded&&a.addClass("gridster-loaded"),m.$broadcast("gridster-resized",[e,a[0].offsetHeight],l))},o=f(function(){n(),g(function(){e.$apply()})},100);e.$watch(function(){return d(a[0])},o),"function"==typeof window.addResizeListener?window.addResizeListener(a[0],o):e.$watch(function(){return a[0].offsetWidth||parseInt(a.css("width"),10)},n);var c=R.element(u);c.on("resize",o),e.$on("$destroy",function(){l.destroy(),c.off("resize",o),"function"==typeof window.removeResizeListener&&window.removeResizeListener(a[0],o)}),g(function(){e.$watch("gridster.floating",function(){l.floatItemsUp()}),l.loaded=!0},100)}}}}]).controller("GridsterItemCtrl",function(){this.$element=null,this.gridster=null,this.row=null,this.col=null,this.sizeX=null,this.sizeY=null,this.minSizeX=0,this.minSizeY=0,this.maxSizeX=null,this.maxSizeY=null,this.init=function(e,t){this.$element=e,this.gridster=t,this.sizeX=t.defaultSizeX,this.sizeY=t.defaultSizeY},this.destroy=function(){this.gridster=null,this.$element=null},this.toJSON=function(){return{row:this.row,col:this.col,sizeY:this.sizeY,sizeX:this.sizeX}},this.isMoving=function(){return this.gridster.movingItem===this},this.setPosition=function(e,t){this.gridster.putItem(this,e,t),this.isMoving()||this.setElementPosition()},this.setSize=function(e,t,i){var r="size"+(e=e.toUpperCase()),s="Size"+e;if(""!==t){t=parseInt(t,10),(isNaN(t)||0===t)&&(t=this.gridster["default"+s]);var n="X"===e?this.gridster.columns:this.gridster.maxRows;this["max"+s]&&(n=Math.min(this["max"+s],n)),this.gridster["max"+s]&&(n=Math.min(this.gridster["max"+s],n)),"X"===e&&this.cols?n-=this.cols:"Y"===e&&this.rows&&(n-=this.rows);var o=0;this["min"+s]&&(o=Math.max(this["min"+s],o)),this.gridster["min"+s]&&(o=Math.max(this.gridster["min"+s],o)),t=Math.max(Math.min(t,n),o);var a=this[r]!==t||this["old"+s]&&this["old"+s]!==t;return this["old"+s]=this[r]=t,this.isMoving()||this["setElement"+s](),!i&&a&&(this.gridster.moveOverlappingItems(this),this.gridster.layoutChanged()),a}},this.setSizeY=function(e,t){return this.setSize("Y",e,t)},this.setSizeX=function(e,t){return this.setSize("X",e,t)},this.setElementPosition=function(){this.gridster.isMobile?this.$element.css({marginLeft:this.gridster.margins[0]+"px",marginRight:this.gridster.margins[0]+"px",marginTop:this.gridster.margins[1]+"px",marginBottom:this.gridster.margins[1]+"px",top:"",left:""}):this.$element.css({margin:0,top:this.row*this.gridster.curRowHeight+(this.gridster.outerMargin?this.gridster.margins[0]:0)+"px",left:this.col*this.gridster.curColWidth+(this.gridster.outerMargin?this.gridster.margins[1]:0)+"px"})},this.setElementSizeY=function(){this.gridster.isMobile&&!this.gridster.saveGridItemCalculatedHeightInMobile?this.$element.css("height",""):this.$element.css("height",this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]+"px")},this.setElementSizeX=function(){this.gridster.isMobile?this.$element.css("width",""):this.$element.css("width",this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]+"px")},this.getElementSizeX=function(){return this.sizeX*this.gridster.curColWidth-this.gridster.margins[1]},this.getElementSizeY=function(){return this.sizeY*this.gridster.curRowHeight-this.gridster.margins[0]}}).factory("GridsterTouch",[function(){return function(c,g,u,m){var e,t,f={},v=function(e){if(Object.keys)return Object.keys(e).length;var t,i=0;for(t in e)++i;return i},p=function(e){for(var t=0,i=0,r=navigator.userAgent.match(/\bMSIE\b/),s=e;null!=s;s=s.offsetParent)r&&(!document.documentMode||document.documentMode<8)&&"relative"===s.currentStyle.position&&s.offsetParent&&"relative"===s.offsetParent.currentStyle.position&&s.offsetLeft===s.offsetParent.offsetLeft||(t+=s.offsetLeft),i+=s.offsetTop;return{x:t,y:i}},w=p(c),z=!1,b=function(e){if("mousemove"!==e.type||0!==v(f)){for(var t=!0,i=e.changedTouches?e.changedTouches:[e],r=0;r<i.length;++r){var s=i[r],n=void 0!==s.identifier?s.identifier:void 0!==s.pointerId?s.pointerId:1;if(void 0===s.pageX)if(s.pageX=s.offsetX+w.x,s.pageY=s.offsetY+w.y,s.srcElement.offsetParent===c&&document.documentMode&&8===document.documentMode&&"mousedown"===s.type)s.pageX+=s.srcElement.offsetLeft,s.pageY+=s.srcElement.offsetTop;else if(s.srcElement!==c&&!document.documentMode||document.documentMode<8){for(var o=-2,a=-2,l=s.srcElement;null!==l;l=l.parentNode)o+=l.scrollLeft?l.scrollLeft:0,a+=l.scrollTop?l.scrollTop:0;s.pageX=s.clientX+o,s.pageY=s.clientY+a}var d=s.pageX,h=s.pageY;e.type.match(/(start|down)$/i)?(w=p(c),f[n]&&(m&&m({target:e.target,which:e.which,pointerId:n,pageX:d,pageY:h}),delete f[n]),g&&t&&(t=g({target:e.target,which:e.which,pointerId:n,pageX:d,pageY:h})),f[n]={x:d,y:h},c.msSetPointerCapture&&t?c.msSetPointerCapture(n):"mousedown"===e.type&&1===v(f)&&(z?c.setCapture(!0):(document.addEventListener("mousemove",b,!1),document.addEventListener("mouseup",b,!1),document.addEventListener("mouseleave",b,!1)))):e.type.match(/move$/i)?!f[n]||f[n].x===d&&f[n].y===h||(u&&t&&(t=u({target:e.target,which:e.which,pointerId:n,pageX:d,pageY:h})),f[n].x=d,f[n].y=h):f[n]&&e.type.match(/(up|end|cancel|leave)$/i)&&(m&&t&&(t=m({target:e.target,which:e.which,pointerId:n,pageX:d,pageY:h})),delete f[n],c.msReleasePointerCapture?c.msReleasePointerCapture(n):"mouseup"===e.type&&0===v(f)&&(z?c.releaseCapture():(document.removeEventListener("mousemove",b,!1),document.removeEventListener("mouseup",b,!1),document.removeEventListener("mouseleave",b,!1))))}t&&(e.preventDefault&&e.preventDefault(),e.preventManipulation&&e.preventManipulation(),e.preventMouseEvent&&e.preventMouseEvent())}};return this.enable=function(){window.navigator.msPointerEnabled?(c.addEventListener("MSPointerDown",b,!1),c.addEventListener("MSPointerMove",b,!1),c.addEventListener("MSPointerUp",b,!1),c.addEventListener("MSPointerCancel",b,!1),void 0!==c.style.msContentZooming&&(e=c.style.msContentZooming,c.style.msContentZooming="none"),void 0!==c.style.msTouchAction&&(t=c.style.msTouchAction,c.style.msTouchAction="none")):c.addEventListener?(c.addEventListener("touchstart",b,!1),c.addEventListener("touchmove",b,!1),c.addEventListener("touchend",b,!1),c.addEventListener("touchcancel",b,!1),c.addEventListener("mousedown",b,!1),c.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(z=!0,c.addEventListener("mousemove",b,!1),c.addEventListener("mouseup",b,!1))):c.attachEvent&&c.setCapture&&(z=!0,c.attachEvent("onmousedown",function(){return b(window.event),window.event.returnValue=!1}),c.attachEvent("onmousemove",function(){return b(window.event),window.event.returnValue=!1}),c.attachEvent("onmouseup",function(){return b(window.event),window.event.returnValue=!1}))},this.disable=function(){window.navigator.msPointerEnabled?(c.removeEventListener("MSPointerDown",b,!1),c.removeEventListener("MSPointerMove",b,!1),c.removeEventListener("MSPointerUp",b,!1),c.removeEventListener("MSPointerCancel",b,!1),e&&(c.style.msContentZooming=e),t&&(c.style.msTouchAction=t)):c.removeEventListener?(c.removeEventListener("touchstart",b,!1),c.removeEventListener("touchmove",b,!1),c.removeEventListener("touchend",b,!1),c.removeEventListener("touchcancel",b,!1),c.removeEventListener("mousedown",b,!1),c.setCapture&&!window.navigator.userAgent.match(/\bGecko\b/)&&(z=!0,c.removeEventListener("mousemove",b,!1),c.removeEventListener("mouseup",b,!1))):c.detachEvent&&c.setCapture&&(z=!0,c.detachEvent("onmousedown"),c.detachEvent("onmousemove"),c.detachEvent("onmouseup"))},this}}]).factory("GridsterDraggable",["$document","$window","GridsterTouch",function(n,L,o){return function(y,Y,X,C,M){var S,E,c,g,a=0,l=0,u=0,m=0,d=0,h=0,$=n[0],f=["select","option","input","textarea","button"];function e(e){if(-1!==f.indexOf(e.target.nodeName.toLowerCase()))return!1;var t,i=R.element(e.target);if(i.hasClass("gridster-item-resizable-handler"))return!1;if(i.attr("onclick")||i.attr("ng-click"))return!1;if(i.closest&&i.closest(".gridster-no-drag").length)return!1;if(X.draggable&&X.draggable.handle){var r=R.element(y[0].querySelectorAll(X.draggable.handle)),s=!1;e:for(var n=0,o=r.length;n<o;++n){var a=r[n];if(a===e.target){s=!0;break}for(var l=e.target,d=0;d<20;++d){var h=l.parentNode;if(h===y[0]||!h)break;if(h===a){s=!0;break e}l=h}}if(!s)return!1}switch(e.which){case 1:break;case 2:case 3:return}return u=e.pageX,m=e.pageY,S=parseInt(y.css("left"),10),E=parseInt(y.css("top"),10),c=y[0].offsetWidth,g=y[0].offsetHeight,C.col,C.row,t=e,y.addClass("gridster-item-moving"),X.movingItem=C,X.updateHeight(C.sizeY),Y.$apply(function(){X.draggable&&X.draggable.start&&X.draggable.start(t,y,M,C)}),!0}function t(e){if(!y.hasClass("gridster-item-moving")||y.hasClass("gridster-item-resizing"))return!1;var t=X.curWidth-1,i=X.curRowHeight*X.maxRows-1;a=e.pageX,l=e.pageY;var r=a-u+d,s=l-m+h;d=h=0,u=a,m=l;var n=r,o=s;return S+n<0?d=n-(r=0-S):t<S+c+n&&(d=n-(r=t-S-c)),E+o<0?h=o-(s=0-E):i<E+g+o&&(h=o-(s=i-E-g)),S+=r,E+=s,y.css({top:E+"px",left:S+"px"}),function(e){var t=C.row,i=C.col,r=X.draggable&&X.draggable.drag,s=X.draggable.scrollSensitivity,n=X.draggable.scrollSpeed,o=Math.min(X.pixelsToRows(E),X.maxRows-1),a=Math.min(X.pixelsToColumns(S),X.columns-1),l=X.getItems(o,a,C.sizeX,C.sizeY,C),d=0!==l.length;if(!0===X.swapping&&d){var h=X.getBoundingBox(l),c=h.sizeX===C.sizeX&&h.sizeY===C.sizeY,g=h.row===t,u=h.col===i,m=h.row===o&&h.col===a,f=g||u;if(c&&1===l.length){if(m)X.swapItems(C,l[0]);else if(f)return}else if(h.sizeX<=C.sizeX&&h.sizeY<=C.sizeY&&f)for(var v=C.row<=o?C.row:o+C.sizeY,p=C.col<=a?C.col:a+C.sizeX,w=v-h.row,z=p-h.col,b=0,x=l.length;b<x;++b){var I=l[b];0===X.getItems(I.row+w,I.col+z,I.sizeX,I.sizeY,C).length&&X.putItem(I,I.row+w,I.col+z)}}!1===X.pushing&&d||(C.row=o,C.col=a),e.pageY-$.body.scrollTop<s?$.body.scrollTop=$.body.scrollTop-n:L.innerHeight-(e.pageY-$.body.scrollTop)<s&&($.body.scrollTop=$.body.scrollTop+n),e.pageX-$.body.scrollLeft<s?$.body.scrollLeft=$.body.scrollLeft-n:L.innerWidth-(e.pageX-$.body.scrollLeft)<s&&($.body.scrollLeft=$.body.scrollLeft+n),(r||t!==C.row||i!==C.col)&&Y.$apply(function(){r&&X.draggable.drag(e,y,M,C)})}(e),!0}function i(e){return!(!y.hasClass("gridster-item-moving")||y.hasClass("gridster-item-resizing")||(d=h=0,function(e){y.removeClass("gridster-item-moving");var t=Math.min(X.pixelsToRows(E),X.maxRows-1),i=Math.min(X.pixelsToColumns(S),X.columns-1);!1===X.pushing&&0!==X.getItems(t,i,C.sizeX,C.sizeY,C).length||(C.row=t,C.col=i),X.movingItem=null,C.setPosition(C.row,C.col),Y.$apply(function(){X.draggable&&X.draggable.stop&&X.draggable.stop(e,y,M,C)})}(e),0))}var r=null,s=null;this.enable=function(){!0!==r&&(r=!0,s?s.enable():(s=new o(y[0],e,t,i)).enable())},this.disable=function(){!1!==r&&(r=!1,s&&s.disable())},this.toggle=function(e){e?this.enable():this.disable()},this.destroy=function(){this.disable()}}}]).factory("GridsterResizable",["GridsterTouch",function(X){return function(b,x,I,y,Y){function e(c){var g,u,m,f,i,o=c,a=0,l=0,d=0,h=0,v=0,p=0,w=function(){return(y.minSizeY?y.minSizeY:1)*I.curRowHeight-I.margins[0]},z=function(){return(y.minSizeX?y.minSizeX:1)*I.curColWidth-I.margins[1]};function e(e){switch(e.which){case 1:break;case 2:case 3:return}var t;return(i=I.draggable.enabled)&&(I.draggable.enabled=!1,x.$broadcast("gridster-draggable-changed",I)),d=e.pageX,h=e.pageY,g=parseInt(b.css("left"),10),u=parseInt(b.css("top"),10),m=b[0].offsetWidth,f=b[0].offsetHeight,y.sizeX,y.sizeY,t=e,b.addClass("gridster-item-moving"),b.addClass("gridster-item-resizing"),(I.movingItem=y).setElementSizeX(),y.setElementSizeY(),y.setElementPosition(),I.updateHeight(1),x.$apply(function(){I.resizable&&I.resizable.start&&I.resizable.start(t,b,Y,y)}),!0}function t(e){var t=I.curWidth-1;a=e.pageX,l=e.pageY;var i=a-d+v,r=l-h+p;v=p=0,d=a,h=l;var s=r,n=i;return 0<=o.indexOf("n")&&(f-s<w()?(r=f-w(),p=s-r):u+s<0&&(p=s-(r=0-u)),u+=r,f-=r),0<=o.indexOf("s")&&(f+s<w()?(r=w()-f,p=s-r):9999<u+f+s&&(p=s-(r=9999-u-f)),f+=r),0<=o.indexOf("w")&&(m-n<z()?(i=m-z(),v=n-i):g+n<0&&(v=n-(i=0-g)),g+=i,m-=i),0<=o.indexOf("e")&&(m+n<z()?(i=z()-m,v=n-i):t<g+m+n&&(v=n-(i=t-g-m)),m+=i),b.css({top:u+"px",left:g+"px",width:m+"px",height:f+"px"}),function(e){var t=y.row,i=y.col,r=y.sizeX,s=y.sizeY,n=I.resizable&&I.resizable.resize,o=y.col;-1!==["w","nw","sw"].indexOf(c)&&(o=I.pixelsToColumns(g,!1));var a=y.row;-1!==["n","ne","nw"].indexOf(c)&&(a=I.pixelsToRows(u,!1));var l=y.sizeX;-1===["n","s"].indexOf(c)&&(l=I.pixelsToColumns(m,!0));var d=y.sizeY;-1===["e","w"].indexOf(c)&&(d=I.pixelsToRows(f,!0)),!(-1<a&&-1<o&&l+o<=I.columns&&d+a<=I.maxRows)||!1===I.pushing&&0!==I.getItems(a,o,l,d,y).length||(y.row=a,y.col=o,y.sizeX=l,y.sizeY=d);var h=y.row!==t||y.col!==i||y.sizeX!==r||y.sizeY!==s;(n||h)&&x.$apply(function(){n&&I.resizable.resize(e,b,Y,y)})}(e),!0}function r(e){var t;return I.draggable.enabled!==i&&(I.draggable.enabled=i,x.$broadcast("gridster-draggable-changed",I)),v=p=0,t=e,b.removeClass("gridster-item-moving"),b.removeClass("gridster-item-resizing"),I.movingItem=null,y.setPosition(y.row,y.col),y.setSizeY(y.sizeY),y.setSizeX(y.sizeX),x.$apply(function(){I.resizable&&I.resizable.stop&&I.resizable.stop(t,b,Y,y)}),!0}var s,n=null;this.enable=function(){n||(n=R.element('<div class="gridster-item-resizable-handler handle-'+o+'"></div>'),b.append(n)),(s=new X(n[0],e,t,r)).enable()},this.disable=function(){n&&(n.remove(),n=null),s.disable(),s=void 0},this.destroy=function(){this.disable()}}var i=[],t=I.resizable.handles;"string"==typeof t&&(t=I.resizable.handles.split(","));for(var r=!1,s=0,n=t.length;s<n;s++)i.push(new e(t[s]));this.enable=function(){if(!r){for(var e=0,t=i.length;e<t;e++)i[e].enable();r=!0}},this.disable=function(){if(r){for(var e=0,t=i.length;e<t;e++)i[e].disable();r=!1}},this.toggle=function(e){e?this.enable():this.disable()},this.destroy=function(){for(var e=0,t=i.length;e<t;e++)i[e].destroy()}}}]).factory("gridsterDebounce",function(){return function(r,s,n){var o;return function(){var e=this,t=arguments,i=n&&!o;clearTimeout(o),o=setTimeout(function(){o=null,n||r.apply(e,t)},s),i&&r.apply(e,t)}}}).directive("gridsterItem",["$parse","GridsterDraggable","GridsterResizable","gridsterDebounce",function(x,I,y,Y){return{scope:!0,restrict:"EA",controller:"GridsterItemCtrl",controllerAs:"gridsterItem",require:["^gridster","gridsterItem"],link:function(r,e,t,i){var s,n=t.gridsterItem,o=i[0],a=i[1];if(r.gridster=o,n){var l=x(n);!(s=l(r)||{})&&l.assign&&(s={row:a.row,col:a.col,sizeX:a.sizeX,sizeY:a.sizeY,minSizeX:0,minSizeY:0,maxSizeX:null,maxSizeY:null},l.assign(r,s))}else s=t;a.init(e,o),e.addClass("gridster-item");for(var d=["minSizeX","maxSizeX","minSizeY","maxSizeY","sizeX","sizeY","row","col"],h={},c=[],g=function(e){var t;if("string"==typeof s[e])t=s[e];else if("string"==typeof s[e.toLowerCase()])t=s[e.toLowerCase()];else{if(!n)return;t=n+"."+e}c.push('"'+e+'":'+t),h[e]=x(t);var i=h[e](r);"number"==typeof i&&(a[e]=i)},u=0,m=d.length;u<m;++u)g(d[u]);var f="{"+c.join(",")+"}";r.$watchCollection(f,function(e,t){for(var i in e){var r=e[i];t[i]!==r&&(r=parseInt(r,10),isNaN(r)||(a[i]=r))}}),r.$watch(function(){return a.row+","+a.col},function(){a.setPosition(a.row,a.col),h.row&&h.row.assign&&h.row.assign(r,a.row),h.col&&h.col.assign&&h.col.assign(r,a.col)}),r.$watch(function(){return a.sizeY+","+a.sizeX+","+a.minSizeX+","+a.maxSizeX+","+a.minSizeY+","+a.maxSizeY},function(){var e=a.setSizeX(a.sizeX,!0);e&&h.sizeX&&h.sizeX.assign&&h.sizeX.assign(r,a.sizeX);var t=a.setSizeY(a.sizeY,!0);t&&h.sizeY&&h.sizeY.assign&&h.sizeY.assign(r,a.sizeY),(e||t)&&(a.gridster.moveOverlappingItems(a),o.layoutChanged(),r.$broadcast("gridster-item-resized",a))});var v=new I(e,r,o,a,s),p=new y(e,r,o,a,s),w=function(){p.toggle(!o.isMobile&&o.resizable&&o.resizable.enabled)};w();var z=function(){v.toggle(!o.isMobile&&o.draggable&&o.draggable.enabled)};z(),r.$on("gridster-draggable-changed",z),r.$on("gridster-resizable-changed",w),r.$on("gridster-resized",w),r.$on("gridster-mobile-changed",function(){w(),z()});var b=Y(function(){r.$apply(function(){r.$broadcast("gridster-item-transition-end",a)})},50);return e.on(function(){var e=document.createElement("div"),t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(var i in t)if(void 0!==e.style[i])return t[i]}(),b),r.$broadcast("gridster-item-initialized",a),r.$on("$destroy",function(){try{p.destroy(),v.destroy()}catch(e){}try{o.removeItem(a)}catch(e){}try{a.destroy()}catch(e){}})}}}]).directive("gridsterNoDrag",function(){return{restrict:"A",link:function(e,t){t.addClass("gridster-no-drag")}}})});